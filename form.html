<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulaire de Mission</title>
<link rel="stylesheet" href="form-styles.css">
</head>
<body>
<header class="title">
    <h1>Ordre de mission interne</h1>
</header>
<form id="mission-form">

    <div class="omi">
        <div class="input-box">
            <label for="omi-number"></label>
            <input type="text" id="omi-number" name="omi-number" placeholder=" ajouter /2024 apres le N°" required=""><br>
        </div>
        <div class="Matricule">
            <label for="Matricule"></label>
            <input type="text" id="Matricule" placeholder="Matricule" name="Matricule" required=""><br>   
        </div>
        <div class="Date">
            <label for="Date"></label>
            <input type="date" id="Date"  name="Date" disabled ><br>   
        </div>

    </div>

    <label for="fullName"></label>
    <input type="text" id="fullName" placeholder="Nom et prénom:" name="fullName" required=""><br>

    <label for="jobTitle"></label>
    <input type="text" id="jobTitle" placeholder="Fonction" name="jobTitle" required=""><br>

    <div class="div-sv">
        <div class="division">
            <label for="division"></label>
            <input type="text" id="division" placeholder="Division" name="division" required=""><br>
        </div>
        <div class="service">
            <label for="service"></label>
            <input type="text" id="service" placeholder="Service" name="service" required=""><br>
        </div>
    </div>

    <label for="itineraire"></label>
    <input type="text" id="itineraire" placeholder="Itinéraire" name="itineraire" required=""><br>

    <label for="objet"></label>
    <input type="text" id="objet" placeholder="Objet de la mission" name="objet" required=""><br>

    <div class="date-heur-depart">
        <div class="date-depart">
            <label for="date-depart">Date de départ:</label>
            <input type="date" id="date-depart" name="date-depart" required=""><br>
        </div>
        <div class="heur-depart">
            <label for="heure-depart">Heure de départ:</label>
            <input type="time" id="heure-depart" name="heure-depart"><br>
        </div>
    </div>

    <div class="date-heur-retour">
        <div class="date-retour">
            <label for="date-retour">Date de retour:</label>
            <input type="date" id="date-retour" name="date-retour" required=""><br>
        </div>
        <div class="heur-retour">
            <label for="heure-retour">Heure de retour:</label>
            <input type="time" id="heure-retour" name="heure-retour"><br>
        </div>
    </div>
    <label for="transport"></label>
    <input type="text" id="transport" placeholder="Moyens de transport" name="transport" required=""><br>

    <button type="submit">Enregistrer</button>
</form>


     <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
     <script src="https://apis.google.com/js/api.js"></script>

     
   
     <script>
        
        $(document).ready(function() {
            // Set current date 
            var currentDate = new Date().toISOString().slice(0, 10);
            $('#Date').val(currentDate);
    
            // Handle form submission
            $('#mission-form').submit(function(event) {
                event.preventDefault(); // Prevent default form submission
    
                // Serialize form data
                var formData = $(this).serializeArray();
   
                // Store form data in localStorage for temporary storage (optional)
                localStorage.setItem('formData', JSON.stringify(formData));
    
                // Redirect to index.html
                window.location.href = 'index.html';
            });

            $('#Matricule').on('input', function() {
                var matricule = $(this).val().trim();

                if (matricule === '') {
                    clearFormFields();
                    return;
                }

                // Fetch data from Excel file
                fetchDataFromExcel(matricule);
            });

            function fetchDataFromExcel(matricule) {
                var url = 'data.xlsx';
                var req = new XMLHttpRequest();
                req.open('GET', url, true);
                req.responseType = 'arraybuffer';

                req.onload = function(e) {
                    var data = new Uint8Array(req.response);
                    var workbook = XLSX.read(data, { type: 'array' });

                    // Assuming data is in the first sheet (index 0)
                    var sheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[sheetName];

                    // Convert Excel data to JSON format
                    var jsonData = XLSX.utils.sheet_to_json(worksheet);

                    // Find matching row based on matricule
                    var result = jsonData.find(function(entry) {
                        return entry.Matricule === matricule;
                    });

                    // Populate form fields
                    if (result) {
                        $('#fullName').val(result.fullName);
                        $('#jobTitle').val(result.jobTitle);
                        $('#division').val(result.division);
                        $('#service').val(result.service);
                        // You can populate other fields similarly here
                    } else {
                        clearFormFields();
                    }
                };

                req.send();
            }

            function clearFormFields() {
                $('#fullName').val('');
                $('#jobTitle').val('');
                $('#division').val('');
                $('#service').val('');
                // Clear other fields as needed
            }
        });

        
    </script>

</body>
</html>
